<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Evaluation Report - {{ teacher.user.get_full_name }}</title>
    <style>
        /* Print-friendly CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Print styles */
        @media print {
            body {
                padding: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            .page-break {
                page-break-after: always;
            }
            
            table {
                page-break-inside: avoid;
            }
            
            h1, h2, h3 {
                page-break-after: avoid;
            }
        }

        /* Header styles */
        .report-header {
            text-align: center;
            border-bottom: 3px solid #1a237e;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .report-header h1 {
            color: #1a237e;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .report-header h2 {
            color: #283593;
            font-size: 20px;
            font-weight: normal;
        }

        /* Action buttons */
        .action-buttons {
            margin-bottom: 20px;
            text-align: right;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #1a237e;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0d47a1;
        }

        .btn-success {
            background-color: #2e7d32;
            color: white;
        }

        .btn-success:hover {
            background-color: #1b5e20;
        }

        /* Section styles */
        .section {
            margin-bottom: 30px;
        }

        .section-title {
            background-color: #3f51b5;
            color: white;
            padding: 10px 15px;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        /* Info table */
        .info-table {
            width: 100%;
            margin-bottom: 20px;
            border-collapse: collapse;
        }

        .info-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-table td:first-child {
            font-weight: bold;
            color: #1a237e;
            width: 200px;
            text-align: right;
            padding-right: 20px;
        }

        /* Data tables */
        table.data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        table.data-table thead {
            background-color: #3f51b5;
            color: white;
        }

        table.data-table th {
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }

        table.data-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        table.data-table tbody tr:nth-child(even) {
            background-color: #f5f5f5;
        }

        table.data-table tbody tr:hover {
            background-color: #e3f2fd;
        }

        /* Rating badges */
        .rating-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .rating-outstanding {
            background-color: #4caf50;
            color: white;
        }

        .rating-very-good {
            background-color: #8bc34a;
            color: white;
        }

        .rating-good {
            background-color: #cddc39;
            color: #333;
        }

        .rating-satisfactory {
            background-color: #ffeb3b;
            color: #333;
        }

        .rating-fair {
            background-color: #ff9800;
            color: white;
        }

        .rating-needs-improvement {
            background-color: #f44336;
            color: white;
        }

        /* Problem severity */
        .severity-high {
            color: #d32f2f;
            font-weight: bold;
        }

        .severity-medium {
            color: #f57c00;
            font-weight: bold;
        }

        .severity-low {
            color: #388e3c;
        }

        /* Suggestions box */
        .suggestions-box {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .suggestions-box strong {
            color: #e65100;
        }

        /* Statistics cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: #f5f5f5;
            border-left: 4px solid #3f51b5;
            padding: 15px;
            border-radius: 4px;
        }

        .stat-card .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-card .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a237e;
        }

        .stat-card .stat-descriptor {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Footer */
        .report-footer {
            text-align: center;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            margin-top: 40px;
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Action Buttons (hidden when printing) -->
    <div class="action-buttons no-print">
        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Report</button>
        <a href="{% url 'reports:teacher_report_pdf' teacher.id %}{% if academic_year %}?academic_year={{ academic_year.id }}{% endif %}{% if semester %}&semester={{ semester.id }}{% endif %}" 
           class="btn btn-success">üìÑ Download PDF</a>
    </div>

    <!-- Report Header -->
    <div class="report-header">
        <h1>Teacher Evaluation Report</h1>
        <h2>{{ teacher.user.get_full_name }}</h2>
    </div>

    <!-- Teacher Information Section -->
    <div class="section">
        <div class="section-title">Teacher Information</div>
        <table class="info-table">
            <tr>
                <td>Employee ID:</td>
                <td>{{ teacher.employee_id }}</td>
            </tr>
            <tr>
                <td>Department:</td>
                <td>{{ teacher.department }}</td>
            </tr>
            <tr>
                <td>Qualification:</td>
                <td>{{ teacher.qualification }}</td>
            </tr>
            <tr>
                <td>Experience:</td>
                <td>{{ teacher.experience_years }} years</td>
            </tr>
            <tr>
                <td>Subjects Teaching:</td>
                <td>{{ teacher.get_subjects_list|default:"N/A" }}</td>
            </tr>
            {% if academic_year %}
            <tr>
                <td>Academic Year:</td>
                <td>{{ academic_year }}</td>
            </tr>
            {% endif %}
            {% if semester %}
            <tr>
                <td>Semester:</td>
                <td>{{ semester }}</td>
            </tr>
            {% endif %}
            <tr>
                <td>Report Generated:</td>
                <td>{{ current_date }}</td>
            </tr>
        </table>
    </div>

    <!-- Evaluation Summary Statistics -->
    <div class="section">
        <div class="section-title">Evaluation Summary</div>
        
        {% if evaluations %}
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Evaluations</div>
                <div class="stat-value">{{ total_evaluations }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Overall Rating</div>
                <div class="stat-value">{{ average_rating|floatformat:2 }}</div>
                <div class="stat-descriptor">{{ rating_descriptor }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Presentation</div>
                <div class="stat-value">{{ presentation_avg|floatformat:2 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Development</div>
                <div class="stat-value">{{ development_avg|floatformat:2 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Student Behavior</div>
                <div class="stat-value">{{ student_behavior_avg|floatformat:2 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Wrap-up</div>
                <div class="stat-value">{{ wrapup_avg|floatformat:2 }}</div>
            </div>
        </div>

        <!-- Detailed Ratings Table -->
        <table class="data-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Average Score</th>
                    <th>Performance Level</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="text-align: left;">Presentation of Lesson</td>
                    <td>{{ presentation_avg|floatformat:2 }}</td>
                    <td>
                        <span class="rating-badge rating-{{ presentation_descriptor|lower|cut:" " }}">
                            {{ presentation_descriptor }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">Development of Lesson</td>
                    <td>{{ development_avg|floatformat:2 }}</td>
                    <td>
                        <span class="rating-badge rating-{{ development_descriptor|lower|cut:" " }}">
                            {{ development_descriptor }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">Expected Student Behavior</td>
                    <td>{{ student_behavior_avg|floatformat:2 }}</td>
                    <td>
                        <span class="rating-badge rating-{{ student_behavior_descriptor|lower|cut:" " }}">
                            {{ student_behavior_descriptor }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">Wrap-up</td>
                    <td>{{ wrapup_avg|floatformat:2 }}</td>
                    <td>
                        <span class="rating-badge rating-{{ wrapup_descriptor|lower|cut:" " }}">
                            {{ wrapup_descriptor }}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
        {% else %}
        <p>No evaluations found for the specified criteria.</p>
        {% endif %}
    </div>

    <!-- Evaluations by Subject -->
    {% if subjects_data %}
    <div class="section page-break">
        <div class="section-title">Evaluation Details by Subject</div>
        
        {% for subject in subjects_data %}
        <h3 style="color: #3f51b5; margin: 20px 0 10px 0;">
            {{ subject.code }} - {{ subject.name }} (Avg: {{ subject.average|floatformat:2 }})
        </h3>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Overall Rating</th>
                    <th>Date Evaluated</th>
                </tr>
            </thead>
            <tbody>
                {% for eval in subject.evaluations %}
                <tr>
                    <td style="text-align: left;">{{ eval.student.user.get_full_name }}</td>
                    <td>{{ eval.get_average_rating|floatformat:2 }}</td>
                    <td>{{ eval.created_at|date:"M d, Y" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Problem Analysis -->
    {% if evaluations %}
    <div class="section page-break">
        <div class="section-title">Problem Analysis</div>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>Problem Type</th>
                    <th>Avg Severity</th>
                    <th>Very Serious</th>
                    <th>Serious</th>
                    <th>Not Serious</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="text-align: left;">Late to Class</td>
                    <td class="{% if late_avg >= 2.5 %}severity-high{% elif late_avg >= 2.0 %}severity-medium{% else %}severity-low{% endif %}">
                        {{ late_avg|floatformat:2 }}
                    </td>
                    <td>{{ late_very_serious }}</td>
                    <td>{{ late_serious }}</td>
                    <td>{{ late_not_serious }}</td>
                </tr>
                <tr>
                    <td style="text-align: left;">Absenteeism</td>
                    <td class="{% if absent_avg >= 2.5 %}severity-high{% elif absent_avg >= 2.0 %}severity-medium{% else %}severity-low{% endif %}">
                        {{ absent_avg|floatformat:2 }}
                    </td>
                    <td>{{ absent_very_serious }}</td>
                    <td>{{ absent_serious }}</td>
                    <td>{{ absent_not_serious }}</td>
                </tr>
                <tr>
                    <td style="text-align: left;">Long Video Presentations</td>
                    <td class="{% if video_avg >= 2.5 %}severity-high{% elif video_avg >= 2.0 %}severity-medium{% else %}severity-low{% endif %}">
                        {{ video_avg|floatformat:2 }}
                    </td>
                    <td>{{ video_very_serious }}</td>
                    <td>{{ video_serious }}</td>
                    <td>{{ video_not_serious }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Student Suggestions -->
    <div class="section">
        <div class="section-title">Student Suggestions & Feedback</div>
        
        {% for eval in evaluations|slice:":10" %}
            {% if eval.suggestions %}
            <div class="suggestions-box">
                <strong>{{ eval.student.user.get_full_name }}</strong> ({{ eval.subject.code }}):
                <p style="margin-top: 8px;">{{ eval.suggestions }}</p>
            </div>
            {% endif %}
        {% endfor %}
        
        {% if evaluations|length > 10 %}
        <p style="font-style: italic; color: #666;">
            ... and {{ evaluations|length|add:"-10" }} more evaluations with feedback
        </p>
        {% endif %}
    </div>
    {% endif %}

    <!-- Report Footer -->
    <div class="report-footer">
        <p>This report was generated by the Teacher Evaluation System</p>
        <p>Generated on: {{ current_date }}</p>
        <p>¬© {{ current_year }} Your Institution Name. All rights reserved.</p>
    </div>
</body>
</html>